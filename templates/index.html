<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>Starter Template Â· Bootstrap</title>


    <!-- Bootstrap core CSS -->
	<link href="https://getbootstrap.com/docs/4.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css"/>


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="#">Podcast Search</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
		<li class="nav-item">
			<a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">@Post</a>
		</li>
		<!-- <li class="nav-item active">
			<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
		</li> -->
       
      <!-- <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li> -->
     
      <li class="nav-item">
        <a class="nav-link" href="#" data-toggle="modal" data-target="#StatusModal">System Status </a>
      </li>
      <!-- <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
        <div class="dropdown-menu" aria-labelledby="dropdown01">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li> -->
    </ul>
    <form action="/api/search" method="post" id="search-form" class="form-inline my-2 my-lg-0">
      <input name="query" class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
      <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
    </form>
  </div>
</nav>

<div class="container">
	<div class="card-deck">
	</div>
</div>
<div class="modal fade" id="StatusModal" tabindex="-1" role="dialog" aria-labelledby="StatusModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="StatusModallLabel">System Status</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
			<div class="input-group mb-3">
				<div class="input-group-prepend">
					<span class="input-group-text" id="basic-addon3">Discovered</span>
				</div>
				<input type="text" class="form-control" id="discovered-podcasts" aria-describedby="basic-addon3" value="Loading..." readonly>
			</div>
			<div class="input-group mb-3">
				<div class="input-group-prepend">
					<span class="input-group-text" id="basic-addon3">Composed</span>
				</div>
				<input type="text" class="form-control" id="composed-podcasts" aria-describedby="basic-addon3" value="Loading..." readonly>
			</div>
			<div class="input-group mb-3">
				<div class="input-group-prepend">
					<span class="input-group-text" id="basic-addon3">Indexed</span>
				</div>
				<input type="text" class="form-control" id="indexed-podcasts" aria-describedby="basic-addon3" value="Loading..." readonly>
			</div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="https://getbootstrap.com/docs/4.3/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="https://getbootstrap.com/docs/4.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script>
	$( "#search-form" ).submit(function( event ) {
		event.preventDefault();
		$(".card-deck").html('')
		NProgress.start();
		var post_url = $(this).attr("action"); //get form action url
		var request_method = $(this).attr("method"); //get form GET/POST method
		var form_data = $(this).serialize(); //Encode form elements for submission
		$.ajax({
			url : post_url,
			type: request_method,
			data : form_data,
			dataType: 'json'
		}).done(function(response){ //
			
			response.forEach((item) => {
				$.ajax({
					url : 'https://audio-api.washpost.arcpublishing.com/api/v1/audio/'+item.pid,
					type: 'GET',
					dataType: 'json'
				}).done(function(response){
					console.log(response.id)
					if (response.images.coverImage.url != null && response.seriesMeta.seriesSlug != null && response.seriesMeta.seriesSlug != 'admin-and-testing') {
						url = 'https://www.washingtonpost.com/podcasts/'+response.seriesMeta.seriesSlug+'/'+response.slug
						html = '<div class="card my-3"><img src="'+response.images.coverImage.url+'" class="card-img-top"><div class="card-body"><h4 class="card-title">'+response.title+'</h4><p class="card-text">'+response.shortDescription+'</p><a href="'+url+'" class="btn btn-primary" role="button" target="_blank">Listen</a></div></div>';
						$(".card-deck").append(html);
					}
					
				});
				
			});
			NProgress.done();
			
		});
	});
	$('#StatusModal').on('show.bs.modal', function (event) {
		// var modal = $(this)
		// modal.find('.modal-title').text('System Status')
		$.ajax({
			url : '/api/stats',
			type: 'GET',
			dataType: 'json'
		}).done(function(response){
			$("#discovered-podcasts").val(response.collect_count);
			$("#composed-podcasts").val(response.compose_count);
			$("#indexed-podcasts").val(response['postings.krovetz']['statistics/highestDocumentCount']);
		});
		
	})
	$('#StatusModal').on('hidden.bs.modal', function (event) {
		$("#discovered-podcasts").val("Loading...");
		$("#composed-podcasts").val("Loading...");
		$("#indexed-podcasts").val("Loading...");
	})
	</script>
  </body>
</html>